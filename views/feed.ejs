<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Global Feed</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-900 text-zinc-200">

<div class="w-full h-12 flex items-center bg-zinc-500 px-4 sm:px-6 md:px-20 mb-5">
    <h1 class="tracking-tighter text-xl sm:text-2xl md:text-3xl text-black underline decoration-2">Anonymus.</h1>
    <button onclick="window.location.href='/profile'" class="ml-auto mt-1 sm:mt-2 mr-2 sm:mr-4 px-3 py-1 bg-blue-500 rounded-md text-white text-sm sm:text-lg hover:bg-blue-800 transition mb-2">Profile</button>
     <button onclick="window.location.href='/create'" class="mt-1 sm:mt-2 mr-2  sm:mr-4 px-3 py-1 bg-white rounded-md text-blue-600 text-sm sm:text-lg hover:bg-gray-300 transition mb-2">Home</button>
  </div>

<div class="max-w-3xl mx-auto p-4">
<h3 >
  <span class="text-2xl font-bold underline decoration-violet-500 inline-block text-violet-300 bg-violet-600/40  px-3 py-1 rounded-md mb-5">
  Global Feed 
</span> <span class="text-3xl">ü•∏</span>
</h3>
  <% posts.forEach(post => { %>
    <div class="bg-zinc-800 p-4 rounded mb-4 shadow-md">

      <p class="text-sm text-blue-400 mb-1">
        @<%= post.user ? post.user.username : "deleted_user" %>

        <% if (post.user && post.user._id.toString() === user._id.toString()) { %>
          <span class="text-green-400 ml-2">(You)</span>
        <% } %>
      </p>

      <p class="mb-2"><%= post.content %></p>

      <div class="flex gap-4 items-center text-sm text-gray-400">

      <button 
  class="like-btn flex items-center gap-1 text-gray-400 hover:text-red-400 transition"
  data-id="<%= post._id %>"
>
<span class="heart <%= post.likes.map(id => id.toString()).includes(user._id.toString()) ? 'text-red-500' : '' %>">‚ù§Ô∏è</span>
  <span class="like-count"><%= post.likes.length %></span>
</button>


        <% if (post.user && post.user._id.toString() === user._id.toString()) { %>
          <a href="/edit/<%= post._id %>" class="text-orange-400 underline hover:text-orange-500">
            Edit
          </a>
        <% } %>

      </div>

    </div>
  <% }) %>

  <% if (posts.length === 0) { %>
    <p class="text-gray-400 text-center mt-10">No posts yet. Be the first!</p>
  <% } %>

</div>

<script>
document.querySelectorAll('.like-btn').forEach(btn => {
  btn.addEventListener('click', async () => {
    const postId = btn.dataset.id;

    const res = await fetch(`/api/like/${postId}`, {
      method: 'POST'
    });

    if (!res.ok) return;

    const data = await res.json();

    btn.querySelector('.like-count').textContent = data.likesCount;

    const heart = btn.querySelector('.heart');
    heart.classList.toggle('text-red-500', data.liked);
  });
});
</script>

</body>
</html>
